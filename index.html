<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All-in-One Admission Form</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://smtpjs.com/v3/smtp.js"></script>
<style>
.hidden { display: none; }
</style>
</head>
<body class="bg-gray-100">

<!-- ================= FORM PAGE ================= -->
<div id="formPage" class="max-w-4xl mx-auto mt-10 bg-white p-8 shadow-xl rounded-xl">

<h1 class="text-3xl font-bold text-center mb-6 text-blue-600">
Student Admission Form
</h1>

<form id="admissionForm" class="space-y-4">

<!-- Photo Upload side-by-side -->
<div>
    <label class="font-semibold block mb-2">Student Photo</label>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
        <div>
            <input type="file" id="photoInput" accept="image/*"
                   class="w-full border p-2 rounded">
        </div>
        <div class="w-40 h-40 border-2 border-gray-300 rounded-lg mx-auto flex items-center justify-center overflow-hidden bg-gray-50"
             id="photoPreviewBox">
            <span class="text-gray-400 text-sm">No Photo</span>
        </div>
    </div>
</div>

<!-- Full Name & Father Name -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
        <label class="font-semibold">Full Name</label>
        <input type="text" id="fullName" required class="w-full border p-2 rounded">
    </div>
    <div>
        <label class="font-semibold">Father Name</label>
        <input type="text" id="fatherName" required class="w-full border p-2 rounded">
    </div>
</div>

<!-- DOB & Gender -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
        <label class="font-semibold">Date of Birth</label>
        <input type="date" id="dob" required class="w-full border p-2 rounded">
    </div>
    <div>
        <label class="font-semibold">Gender</label>
        <select id="gender" required class="w-full border p-2 rounded">
            <option value="">Select</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
        </select>
    </div>
</div>

<!-- Contact -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
        <label class="font-semibold">Phone Number</label>
        <input type="text" id="phone" required class="w-full border p-2 rounded">
    </div>
    <div>
        <label class="font-semibold">Email</label>
        <input type="email" id="email" required class="w-full border p-2 rounded">
    </div>
</div>

<!-- CNIC / B-Form -->
<div>
    <label class="font-semibold">CNIC / B-Form Number</label>
    <input type="text" id="cnic" required class="w-full border p-2 rounded">
</div>

<!-- Address -->
<div>
    <label class="font-semibold">Full Address</label>
    <textarea id="address" required class="w-full border p-2 rounded"></textarea>
</div>

<!-- City & Program -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
        <label class="font-semibold">City</label>
        <select id="city" required class="w-full border p-2 rounded">
            <option>Select City</option>
            <option>Karachi</option>
            <option>Lahore</option>
            <option>Islamabad</option>
            <option>Rawalpindi</option>
            <option>Faisalabad</option>
            <option>Multan</option>
            <option>Hyderabad</option>
            <option>Peshawar</option>
            <option>Quetta</option>
        </select>
    </div>
    <div>
        <label class="font-semibold">Applying For</label>
        <select id="program" required class="w-full border p-2 rounded">
            <option value="">Select Option</option>
            <option>School (Nursery–10th)</option>
            <option>College (11th–12th)</option>
            <option>University (Bachelor / Master)</option>
        </select>
    </div>
</div>

<!-- Previous Education -->
<div>
    <label class="font-semibold">Previous Education</label>
    <input type="text" id="previousEducation" placeholder="Matric / Inter / Bachelor etc." class="w-full border p-2 rounded">
</div>

<!-- Emergency Contact -->
<div>
    <label class="font-semibold">Emergency Contact</label>
    <input type="text" id="emergency" class="w-full border p-2 rounded">
</div>

<!-- Feedback / Notes -->
<div>
    <label class="font-semibold">Feedback / Additional Notes</label>
    <textarea id="feedback" class="w-full border p-2 rounded"></textarea>
</div>

<!-- Submit -->
<button type="submit"
    class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-blue-700">
    Submit Application
</button>

</form>

<p id="statusMsg" class="text-center mt-4 font-semibold text-green-600 hidden">
    Form submitted successfully!
</p>

</div>

<!-- ================= ADMIN LOGIN & DASHBOARD ================= -->
<div id="adminPage" class="hidden max-w-5xl mx-auto mt-10 bg-white p-6 shadow-xl rounded-xl">
<h1 class="text-2xl font-bold mb-4">Admin Dashboard</h1>
<button onclick="logout()" class="float-right bg-red-600 text-white py-1 px-4 rounded">Logout</button>

<table class="w-full mt-10 border">
<thead>
<tr class="bg-gray-200">
<th class="p-2 border">ID</th>
<th class="p-2 border">Name</th>
<th class="p-2 border">Phone</th>
<th class="p-2 border">Photo</th>
<th class="p-2 border">PDF</th>
</tr>
</thead>
<tbody id="studentTable"></tbody>
</table>
</div>

<!-- ================= JAVASCRIPT ================= -->
<script>
const photoInput = document.getElementById("photoInput");
const photoPreviewBox = document.getElementById("photoPreviewBox");

// Photo preview
photoInput.addEventListener("change", function(e){
    const file = e.target.files[0];
    if(file){
        const img = document.createElement("img");
        img.src = URL.createObjectURL(file);
        img.classList.add("w-full","h-full","object-cover");
        photoPreviewBox.innerHTML = "";
        photoPreviewBox.appendChild(img);
    }
});

// Form submission
document.getElementById("admissionForm").addEventListener("submit", function(e){
    e.preventDefault();

    const student = {
        id: Date.now(),
        photo: photoPreviewBox.querySelector("img") ? photoPreviewBox.querySelector("img").src : "",
        fullName: document.getElementById("fullName").value,
        fatherName: document.getElementById("fatherName").value,
        dob: document.getElementById("dob").value,
        gender: document.getElementById("gender").value,
        phone: document.getElementById("phone").value,
        email: document.getElementById("email").value,
        cnic: document.getElementById("cnic").value,
        address: document.getElementById("address").value,
        city: document.getElementById("city").value,
        program: document.getElementById("program").value,
        previousEducation: document.getElementById("previousEducation").value,
        emergency: document.getElementById("emergency").value,
        feedback: document.getElementById("feedback").value
    };

    let all = JSON.parse(localStorage.getItem("students") || "[]");
    all.push(student);
    localStorage.setItem("students", JSON.stringify(all));

    generatePDF(student);
    sendEmail(student);

    document.getElementById("statusMsg").classList.remove("hidden");
});

// Generate PDF
function generatePDF(s){
    const { jsPDF } = window.jspdf;
    let pdf = new jsPDF();
    pdf.text("Student Admission Form",10,10);
    pdf.text(`Full Name: ${s.fullName}`,10,20);
    pdf.text(`Father: ${s.fatherName}`,10,30);
    pdf.text(`DOB: ${s.dob}`,10,40);
    pdf.text(`Gender: ${s.gender}`,10,50);
    pdf.text(`Phone: ${s.phone}`,10,60);
    pdf.text(`Email: ${s.email}`,10,70);
    pdf.text(`CNIC: ${s.cnic}`,10,80);
    pdf.text(`Address: ${s.address}`,10,90);
    pdf.text(`City: ${s.city}`,10,100);
    pdf.text(`Program: ${s.program}`,10,110);
    pdf.text(`Previous Education: ${s.previousEducation}`,10,120);
    pdf.text(`Emergency Contact: ${s.emergency}`,10,130);
    pdf.text(`Feedback: ${s.feedback}`,10,140);
    pdf.save(`admission_${s.id}.pdf`);
}

// Fake Email sending (SMTPJS)
function sendEmail(s){
    Email.send({
        SecureToken: "YOUR_SECURE_TOKEN_HERE",
        To: "admin@example.com",
        From: "noreply@example.com",
        Subject: "New Admission Form Submitted",
        Body: `New Admission Form:<br>
        Name: ${s.fullName}<br>
        Phone: ${s.phone}<br>
        Program: ${s.program}`
    });
}

// Admin login / dashboard
function loadDashboard(){
    const all = JSON.parse(localStorage.getItem("students") || "[]");
    let html = "";
    all.forEach(s=>{
        html += `<tr class="border">
            <td class="p-2 border">${s.id}</td>
            <td class="p-2 border">${s.fullName}</td>
            <td class="p-2 border">${s.phone}</td>
            <td class="p-2 border"><img src="${s.photo}" width="60"></td>
            <td class="p-2 border">
                <button class="text-blue-600 underline" onclick='generatePDF(${JSON.stringify(s)})'>
                    Download
                </button>
            </td>
        </tr>`;
    });
    document.getElementById("studentTable").innerHTML = html;
}

function logout(){
    document.getElementById("adminPage").classList.add("hidden");
    document.getElementById("formPage").classList.remove("hidden");
}
</script>

</body>
</html>
